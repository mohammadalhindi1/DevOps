apiVersion: v1
kind: Namespace
metadata:
  name: task-service-ns  # Isolated namespace for this service
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: task-service-deployment  # Deployment name
  namespace: task-service-ns     # Deploy into our custom namespace
spec:
  replicas: 1  # Number of pod replicas to run
  selector:
    matchLabels:
      app: task-service  # Must match pod template labels
  template:
    metadata:
      labels:
        app: task-service  # Label to identify pods of this app
    spec:
      containers:
        - name: task-service-container  # Container name inside the pod
          image: task-service:latest    # Docker image to run (replace with registry image in real env)
          imagePullPolicy: IfNotPresent # Use local image if available
          ports:
            - containerPort: 8000      # Port exposed by the FastAPI app
          livenessProbe:               # Check if the app is still alive
            httpGet:
              path: /health            # Use the health endpoint
              port: 8000
            initialDelaySeconds: 5     # Wait before first check
            periodSeconds: 10          # Check interval
          readinessProbe:              # Check if app is ready to receive traffic
            httpGet:
              path: /health
              port: 8000
            initialDelaySeconds: 3
            periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: task-service-svc        # Service name
  namespace: task-service-ns    # Same namespace as deployment
spec:
  type: NodePort                # Expose service on a node port
  selector:
    app: task-service           # Route traffic to pods with this label
  ports:
    - name: http
      port: 8000               # Service port inside the cluster
      targetPort: 8000         # Pod container port
      nodePort: 30080          # Node port exposed externally (30000-32767)
